\documentclass{beamer} 
\usepackage{multicol}
\usepackage{url}
\usepackage{fancyvrb}
\usepackage{color}

\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\def\PY@tok@gd{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\def\PY@tok@gu{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\def\PY@tok@gt{\def\PY@tc##1{\textcolor[rgb]{0.00,0.25,0.82}{##1}}}
\def\PY@tok@gs{\let\PY@bf=\textbf}
\def\PY@tok@gr{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\def\PY@tok@cm{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\def\PY@tok@vg{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@m{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@mh{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@go{\def\PY@tc##1{\textcolor[rgb]{0.50,0.50,0.50}{##1}}}
\def\PY@tok@ge{\let\PY@it=\textit}
\def\PY@tok@vc{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@il{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@cs{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\def\PY@tok@cp{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\def\PY@tok@gi{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\def\PY@tok@gh{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\def\PY@tok@ni{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\def\PY@tok@nl{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\def\PY@tok@nn{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\def\PY@tok@no{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\def\PY@tok@na{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\def\PY@tok@nb{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@nc{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\def\PY@tok@nd{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\def\PY@tok@ne{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\def\PY@tok@nf{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\def\PY@tok@si{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\def\PY@tok@s2{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@vi{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@nt{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@nv{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@s1{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@sh{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@sc{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@sx{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@bp{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@c1{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\def\PY@tok@kc{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@c{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\def\PY@tok@mf{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@err{\def\PY@bc##1{\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{##1}}}
\def\PY@tok@kd{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@ss{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@sr{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\def\PY@tok@mo{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@kn{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@mi{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@gp{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\def\PY@tok@o{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@kr{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@s{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@kp{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@w{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\def\PY@tok@kt{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\def\PY@tok@ow{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\def\PY@tok@sb{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@k{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@se{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\def\PY@tok@sd{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


\title{(Non) Comprehensive Guide to C/C++ Source Code Quality} 
\author{Sergey Kishchenko} 
\date{March 25th, 2011} 
\usetheme{CambridgeUS}
\usecolortheme{seagull}
\institute{Quickoffice}
\begin{document}

\frame{\titlepage}
\begin{frame} 
\frametitle{Product quality and source code quality}
\begin{multicols}{2}
\center{Source code}

\includegraphics[width=0.4\textwidth]{img/delorean-blueprint}
\columnbreak
\center{Product}

\includegraphics[width=0.4\textwidth]{img/delorean}
\end{multicols}
\begin{center}
\textbf{You can't make a good quality product with bad quality blueprint!}
\end{center}
\end{frame} 

\begin{frame}
\frametitle{Software product quality}
\begin{itemize}
\item Conformance to the specification
\item Completeness
\item Product documentation
\item \textbf{Source code quality}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Source code quality}
\begin{itemize}
\item Correctness(no "bugs"!)
\item Maintainability
\item Readability
\item Portability
\item Low complexity
\item High code reuse
\item Efficiency
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Measuring source code quality}
\begin{itemize}
\item Bugs per line of code
\item Number of lines of code
\item Conformance to the code styling guide
\item Amount of platform-dependent code
\item Code coverage
\item Comment density
\item Program execution time, program size
\end{itemize}
\begin{center}
\textbf{There is no "silver bullet" source code quality metric :(}

\textbf{You should choose some of the points above and produce your own integral metric.}
\end{center}
\end{frame}

\begin{frame}
\begin{block}{\begin{center}\Large\textbf{How to measure and improve source code quality}\end{center}}
\begin{center}
\textbf{Part 1. Tools}
\end{center}
\end{block}
\end{frame}

\begin{frame}[fragile]
\frametitle{CPD}
\begin{center}
\includegraphics[width=0.4\textwidth]{img/copy-paste}
\end{center}
Copy/Paste detection tool. Improves readability, maintainability, increases code reuse, reduces resources usage. You can download it at \url{http://pmd.sourceforge.net/cpd.html}
\begin{exampleblock}{How to use}
\begin{verbatim}
> java net.sourceforge.pmd.cpd.CPD --minimum-tokens 100 \
        --files /path/to/cpp/source --language cpp
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\frametitle{gcc -Wall -ansi -pedantic}
I'm serious, it is one of the best tools you can get. Do not underestimate it. Improves correctness and portability.
\begin{exampleblock}{How to use}
\begin{verbatim}
> gcc -Wall -ansi -pedantic -c /path/to/source/file.cpp
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\frametitle{clang(static analizer)}
C/C++/ObjC frontend for llvm with static analyzer. Improves correctness and portability. You can get clang at \url{http://clang.llvm.org/}
\begin{exampleblock}{How to use}
\begin{verbatim}
> clang --analyze /path/to/source/file.cpp
\end{verbatim} 
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{clang-test.cpp}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+cp}{\PYZsh{}}\PY{c+cp}{include <stdio.h>}

\PY{k+kt}{int} \PY{n}{main}\PY{p}{(}\PY{k+kt}{int} \PY{n}{argc}\PY{p}{,} \PY{k+kt}{char}\PY{o}{*}\PY{o}{*} \PY{n}{argv}\PY{p}{)}
\PY{p}{\PYZob{}}
    \PY{k+kt}{char}\PY{o}{*} \PY{n}{fileName}\PY{p}{;} \PY{c+c1}{// not initialized!}
    \PY{k}{if} \PY{p}{(}\PY{l+m+mi}{2} \PY{o}{=}\PY{o}{=} \PY{n}{argc}\PY{p}{)}
    \PY{p}{\PYZob{}}
        \PY{n}{fileName} \PY{o}{=} \PY{n}{argv}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}
    \PY{p}{\PYZcb{}}
    \PY{c+c1}{// using fileName}
    \PY{n}{FILE}\PY{o}{*} \PY{n}{f} \PY{o}{=} \PY{n}{fopen}\PY{p}{(}\PY{n}{fileName}\PY{p}{,} \PY{l+s}{"}\PY{l+s}{r}\PY{l+s}{"}\PY{p}{)}\PY{p}{;}
    \PY{n}{fclose}\PY{p}{(}\PY{n}{f}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{Result}
\begin{Verbatim}
clang-test.cpp:11:15: warning: Pass-by-value argument in 
      function call is undefined
    FILE* f = fopen(fileName, "r");
              ^     ~~~~~~~~
1 warning generated.
\end{Verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}
\frametitle{Valgrind}
\begin{center}
\includegraphics[width=0.6\textwidth]{img/valgrind}
\end{center}
Improves correctness, efficiency. You can get valgrind at \url{http://valgrind.org}
\end{frame}

\begin{frame}[fragile]
\frametitle{Valgrind. Memcheck}
Memory-management problems detector
\begin{exampleblock}{Usage}
\begin{verbatim}
> valgrind --tool=memcheck /path/to/binary
\end{verbatim}
or
\begin{verbatim}
> valgrind --leak-check=full /path/to/binary
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{memcheck-test.cpp}
\begin{Verbatim}[fontsize=\scriptsize,commandchars=\\\{\}]
\PY{c+cp}{\PYZsh{}}\PY{c+cp}{include <stdexcept>}
\PY{c+cp}{\PYZsh{}}\PY{c+cp}{include <iostream>}

\PY{k}{class} \PY{n+nc}{BuggyPool}
\PY{p}{\PYZob{}}
\PY{k}{public}\PY{o}{:}
    \PY{n}{BuggyPool}\PY{p}{(}\PY{k+kt}{int}\PY{o}{*} \PY{n}{data}\PY{p}{)}
    \PY{p}{\PYZob{}}
        \PY{k}{throw} \PY{n}{std}\PY{o}{:}\PY{o}{:}\PY{n}{runtime\PYZus{}error}\PY{p}{(}\PY{l+s}{"}\PY{l+s}{Hello from BuggyPool}\PY{l+s}{"}
                                 \PY{l+s}{"}\PY{l+s}{(I was written in tough times)}\PY{l+s}{"}\PY{p}{)}\PY{p}{;}
    \PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}\PY{p}{;}

\PY{k+kt}{void} \PY{n}{foo}\PY{p}{(}\PY{p}{)}
\PY{p}{\PYZob{}}
    \PY{k+kt}{int}\PY{o}{*} \PY{n}{values} \PY{o}{=} \PY{k}{new} \PY{k+kt}{int}\PY{p}{[}\PY{l+m+mi}{1024}\PY{p}{]}\PY{p}{;}
    \PY{n}{BuggyPool} \PY{n}{pool}\PY{p}{(}\PY{n}{values}\PY{p}{)}\PY{p}{;}
    \PY{c+c1}{// pool is used somehow}
    \PY{k}{delete} \PY{p}{[}\PY{p}{]} \PY{n}{values}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{memcheck-test.cpp(main function)}
\begin{Verbatim}[fontsize=\footnotesize,commandchars=\\\{\}]
\PY{k+kt}{int} \PY{n}{main}\PY{p}{(}\PY{p}{)}
\PY{p}{\PYZob{}}
    \PY{k}{try}
    \PY{p}{\PYZob{}}
        \PY{n}{foo}\PY{p}{(}\PY{p}{)}\PY{p}{;}
    \PY{p}{\PYZcb{}}
    \PY{k}{catch}\PY{p}{(}\PY{n}{std}\PY{o}{:}\PY{o}{:}\PY{n}{runtime\PYZus{}error}\PY{o}{&} \PY{n}{err}\PY{p}{)}
    \PY{p}{\PYZob{}}
        \PY{n}{std}\PY{o}{:}\PY{o}{:}\PY{n}{cout}\PY{o}{<}\PY{o}{<}\PY{l+s}{"}\PY{l+s}{ERROR: }\PY{l+s}{"}\PY{o}{<}\PY{o}{<} \PY{n}{err}\PY{p}{.}\PY{n}{what}\PY{p}{(}\PY{p}{)}\PY{o}{<}\PY{o}{<}\PY{n}{std}\PY{o}{:}\PY{o}{:}\PY{n}{endl}\PY{p}{;}
    \PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{Result}
\begin{Verbatim}[fontsize=\footnotesize]
==8076== HEAP SUMMARY:
==8076==     in use at exit: 4,096 bytes in 1 blocks
==8076==   total heap usage: 3 allocs, 2 frees, 4,263 bytes allocated
==8076== 
==8076== 4,096 bytes in 1 blocks are definitely lost in loss record 1 of 1
==8076==    at 0x4025F0F: operator new[](unsigned int) (in /usr/lib/...)
==8076==    by 0x8048B55: foo() (memcheck-test.cpp:14)
==8076==    by 0x8048B8D: main (memcheck-test.cpp:24)
==8076== 
==8076== LEAK SUMMARY:
==8076==    definitely lost: 4,096 bytes in 1 blocks
==8076==    indirectly lost: 0 bytes in 0 blocks
==8076==      possibly lost: 0 bytes in 0 blocks
==8076==    still reachable: 0 bytes in 0 blocks
==8076==         suppressed: 0 bytes in 0 blocks
\end{Verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\frametitle{Valgrind. Cachegrind and callgrind}
These tools can be used to build callgraphs and profile your program.
\begin{exampleblock}{Usage}
\begin{verbatim}
> valgrind --tool=callgrind /path/to/binary
\end{verbatim}
and
\begin{verbatim}
> callgrind_annotate [callgrind-out-file [source-files...]]
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{Result (for clang-test.cpp)}
\begin{Verbatim}[fontsize=\footnotesize]
Ir 

 .  #include <stdio.h>
 .  
 .  int main(int argc, char** argv)
 4  {
 .      char* fileName; // not initialized!
 2      if (2 == argc)
 .      {
 .          fileName = argv[1];
 .      }
 .      // using fileName
 5      FILE* f = fopen(fileName, "r");
2,082  => ???:_dl_runtime_resolve (1x)
75,972  => ???:fopen (1x)
 3      fclose(f);
10  => ???:fclose (1x)
1,124  => ???:_dl_runtime_resolve (1x)
 .  }
\end{Verbatim}
\end{exampleblock}
\end{frame}


\begin{frame}
\frametitle{Valgrind. Iogrind, Massif and Helgrind}
Valgrind has a lot of tools, but full review of them will take too much time. So, you can check:
\begin{itemize}
\item Iogrind~--- I/O profiler
\item Massif~--- heap profiles
\item Helgrind~--- data race conditions detector(in threads)
\item ... (and so on. \url{http://valgrind.org} is your friend)
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{cppcheck}
Static analysis tool. Improves correctness, readability, efficiency. You can get it at \url{http://cppcheck.sourceforge.net/}
\begin{exampleblock}{cppcheck-test.cpp}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kt}{int} \PY{n}{main}\PY{p}{(}\PY{p}{)}
\PY{p}{\PYZob{}}
    \PY{k+kt}{int} \PY{n}{values}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{]} \PY{o}{=} \PY{p}{\PYZob{}} \PY{l+m+mi}{0} \PY{p}{\PYZcb{}}\PY{p}{;}
    \PY{n}{values}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{16}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{exampleblock}
\begin{exampleblock}{How to use}
\begin{Verbatim}[fontsize=\small]
> cppcheck --enable=all
[cppcheck-test.cpp:3]: (style) Variable 'values' is assigned a 
                               value that is never used
[cppcheck-test.cpp:4]: (error) Array 'values[10]' index 16 
                               out of bounds
\end{Verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\frametitle{EDoc++}
\begin{center}
\includegraphics[width=0.45\textwidth]{img/exception}
\end{center}
Exception problems detector. Improves correctness. You can get it at \url{http://edoc.sourceforge.net/}
\begin{exampleblock}{How to use}
\begin{verbatim}
> start_edoc.sh
> g++ -fedoc-source -c /path/to/source.cpp
> edoc --show-all --format simple /path/to/source.cpp.edc
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{edoc-test.cpp}
\begin{Verbatim}[fontsize=\footnotesize,commandchars=\\\{\}]
\PY{c+cp}{\PYZsh{}}\PY{c+cp}{include <iostream>}
\PY{k}{class} \PY{n+nc}{C1}\PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}\PY{p}{;}
\PY{k}{class} \PY{n+nc}{C2}\PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}\PY{p}{;}

\PY{k+kt}{void} \PY{n}{foo}\PY{p}{(}\PY{p}{)} \PY{k}{throw} \PY{p}{(}\PY{n}{C1}\PY{p}{)}
\PY{p}{\PYZob{}}
    \PY{k}{throw} \PY{n}{C2}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}
    
\PY{k}{class} \PY{n+nc}{C}
\PY{p}{\PYZob{}}
\PY{k}{public}\PY{o}{:}
    \PY{o}{\PYZti{}}\PY{n}{C}\PY{p}{(}\PY{p}{)}
    \PY{p}{\PYZob{}}
        \PY{n}{foo}\PY{p}{(}\PY{p}{)}\PY{p}{;}
    \PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}\PY{p}{;}

\PY{k+kt}{int} \PY{n}{main}\PY{p}{(}\PY{p}{)} \PY{p}{\PYZob{}} \PY{n}{C} \PY{n}{c}\PY{p}{;} \PY{p}{\PYZcb{}}
\end{Verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{Result}
\begin{Verbatim}[fontsize=\footnotesize]
ERROR(ECRASH_SPEC): Exception may propogate through restrictive specifier:
                    The function: foo() can throw an exception of type: 
                    C2 that is not allowed by its specifier list: 
                    throws(C1)
\end{Verbatim}
\end{exampleblock}
\begin{exampleblock}{After changing throw (C1) to throw (C2)}
\begin{Verbatim}[fontsize=\footnotesize]
ERROR(EMAIN_EXC): An exception may propogate out the main function. :
                  The exception: 
                  C2 may propagate out the main function which may 
                  cause a program abort.

WARNING(WDESTR_EXC): An exception may propogate through a destructor. :
                     Destructor: C::~C(), Exception: C2
\end{Verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}
\begin{block}{\begin{center}\Large\textbf{How to measure and improve source code quality}\end{center}}
\begin{center}
\textbf{Part 2. Tests}
\end{center}
\end{block}
\begin{center}
\includegraphics[width=0.85\textwidth]{img/freeman}
\end{center}
\end{frame}

\begin{frame}
\frametitle{Unit and functional tests}
Unit and functional tests improve correctness, maintainability, readability and portability. Use them! Some of the unit test frameworks:
\begin{itemize}
\item CxxTest~--- \url{http://cxxtest.tigris.org/}
\item Google C++ Testing Framework~--- \url{http://code.google.com/p/googletest/}
\item Boost Test Library~--- \url{http://www.boost.org/doc/libs/1_42_0/libs/test/doc/html/index.html}
\item QtTest~--- \url{http://doc.qt.nokia.com/latest/qtestlib-tutorial.html}
\item CppUnit~--- \url{http://cppunit.sourceforge.net}
\item TUT~--- \url{http://tut-framework.sourceforge.net/}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Tests coverage: GCOV and gcovr}
Just writing tests is not cool enough. Try coverage! It helps with correctness.
\begin{exampleblock}{To use GCOV you should compile with additional flags}
\begin{Verbatim}[fontsize=\small]
> gcc -fprofile-arcs -ftest-coverage /path/to/source.cpp
\end{Verbatim}
\end{exampleblock}
Then you should run your software/tests and then you can use gcovr(\url{https://software.sandia.gov/trac/fast/wiki/gcovr}) to analyze the results:
\begin{exampleblock}{Results for cppcheck-test.cpp}
\begin{Verbatim}[fontsize=\small]
----------------------------------------------------------
File                        Lines    Exec  Cover   Missing
----------------------------------------------------------
/path/to/cppcheck-test.cpp      3       3   100%   
----------------------------------------------------------
TOTAL                           3       3   100%
----------------------------------------------------------
\end{Verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\frametitle{Tests coverage: LCOV}
You can use LCOV to generate cool HTML reports on coverage
\begin{exampleblock}{How to use}
\begin{verbatim}
> lcov --directory /path/to/source/dir --zerocounters
> lcov --directory /path/to/source/dir --capture \
       --output-file app.info
> genhtml app.info
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\frametitle{avalanche}
\begin{center}
\includegraphics[width=0.5\textwidth]{img/cool-dog}
\end{center}
Generates "extreme" test data. 
\begin{exampleblock}{How to use}
\begin{verbatim}
> avalanche --filename=/path/to/seed /path/to/binary \
            /path/to/seed
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{avalanche-test.cpp}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+cp}{\PYZsh{}}\PY{c+cp}{include <stdio.h>}

\PY{k+kt}{int} \PY{n+nf}{main}\PY{p}{(}\PY{k+kt}{int} \PY{n}{argc}\PY{p}{,} \PY{k+kt}{char}\PY{o}{*}\PY{o}{*} \PY{n}{argv}\PY{p}{)}
\PY{p}{\PYZob{}}
    \PY{k+kt}{char} \PY{n}{input}\PY{p}{[}\PY{l+m+mi}{4}\PY{p}{]}\PY{p}{;}
    \PY{k+kt}{FILE}\PY{o}{*}  \PY{n}{fd1} \PY{o}{=} \PY{n}{fopen}\PY{p}{(}\PY{n}{argv}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s}{"}\PY{l+s}{r}\PY{l+s}{"}\PY{p}{)}\PY{p}{;}
    \PY{n}{fread}\PY{p}{(}\PY{n}{input}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{n}{fd1}\PY{p}{)}\PY{p}{;}
    \PY{k}{if} \PY{p}{(}\PY{o}{!}\PY{n}{strncmp}\PY{p}{(}\PY{n}{input}\PY{p}{,}\PY{l+s}{"}\PY{l+s}{bad!}\PY{l+s}{"}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)} \PY{n}{abort}\PY{p}{(}\PY{p}{)}\PY{p}{;}
    \PY{n}{fclose}\PY{p}{(}\PY{n}{fd1}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{exampleblock}
\begin{exampleblock}{Generated exploit\_0\_0 file}
\begin{verbatim}
bad!
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\frametitle{frama-c}
Talk about code quality cannot be complete without mentioning correctness provers. It is almost impossible to use them, but you should know what they are. You can get frama-c at \url{http://frama-c.com/}
\begin{exampleblock}{How to use}
\begin{verbatim}
> frama-c -wp -wp-rte -wp-proof alt-ergo framac-test.c
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
\begin{exampleblock}{framac-test.c}
\begin{Verbatim}[fontsize=\footnotesize,commandchars=\\\{\}]
\PY{c+cp}{\PYZsh{}}\PY{c+cp}{ pragma SeparationPolicy(none)}
\PY{c+cm}{/*@requires \PYZbs{}valid(p);}
\PY{c+cm}{   requires \PYZbs{}valid(q);}
\PY{c+cm}{   assigns *p;}
\PY{c+cm}{   assigns *q;}
\PY{c+cm}{   ensures *p == \PYZbs{}old(*q);}
\PY{c+cm}{   ensures *q == \PYZbs{}old(*p);}
\PY{c+cm}{*/}
\PY{k+kt}{void} \PY{n+nf}{swap}\PY{p}{(}\PY{k+kt}{int}\PY{o}{*} \PY{n}{p}\PY{p}{,} \PY{k+kt}{int}\PY{o}{*} \PY{n}{q}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{k+kt}{int} \PY{k}{const} \PY{n}{save} \PY{o}{=} \PY{o}{*}\PY{n}{p}\PY{p}{;}
  \PY{o}{*}\PY{n}{p} \PY{o}{=} \PY{o}{*}\PY{n}{q}\PY{p}{;}
  \PY{o}{*}\PY{n}{q} \PY{o}{=} \PY{n}{save}\PY{p}{;}
\PY{p}{\PYZcb{}}

\PY{k+kt}{int} \PY{n+nf}{main} \PY{p}{(}\PY{p}{)} \PY{p}{\PYZob{}}
  \PY{k+kt}{int} \PY{n}{p}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]} \PY{o}{=} \PY{p}{\PYZob{}} \PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{\PYZcb{}}\PY{p}{;}
  \PY{k+kt}{int} \PY{o}{*}\PY{n}{q} \PY{o}{=} \PY{p}{(}\PY{k+kt}{int} \PY{o}{*}\PY{p}{)}\PY{p}{(}\PY{p}{(}\PY{k+kt}{char}\PY{o}{*}\PY{p}{)}\PY{n}{q}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
  \PY{n}{swap}\PY{p}{(}\PY{n}{p}\PY{p}{,}\PY{n}{q}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{exampleblock}
\end{frame}


\begin{frame}[fragile]
\begin{exampleblock}{Result}
\begin{verbatim}
[kernel] preprocessing with "gcc -C -E -I.  framac-test.c"
[kernel] preprocessing with "gcc -C -E -I.  framac-test2.c"
[rte] annotating function swap
[wp] [WP:simplified] Goal store_swap_function_assigns : Valid
[wp] [Alt-Ergo] Goal store_swap_assert_4_rte : Valid
[wp] [Alt-Ergo] Goal store_swap_assert_3_rte : Valid
[wp] [Alt-Ergo] Goal store_swap_assert_2_rte : Valid
[wp] [Alt-Ergo] Goal store_swap_assert_1_rte : Valid
[wp] [Alt-Ergo] Goal store_swap_post_1_A : Valid
[wp] [Alt-Ergo] Goal store_swap_post_2_B : Valid
\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}
\frametitle{General ideas}
\begin{itemize}
\item Code review. Improves correctness, readability, maintainability 
\item Continuous integration and automatic build/test/analyze systems
\item Source code documentation. Improves readability. Check out doxygen(\url{http://www.stack.nl/~dimitri/doxygen/})~--- it's cross-platform and easy to use 
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Thank you! Questions?}
\begin{center}
\includegraphics[width=0.45\textwidth]{img/chubaka}
\end{center}
\end{frame}

\end{document}
